import{B as L,r as f,ad as U,au as $,av as I,o as N,h as T,E as j,g as D,aw as O,R as B,Z as K,ax as M,ay as Z,_ as G,k as H,a4 as F,l as m,x as v,n as i,d as a,az as J,z as W,aA as h,a6 as X,q as b,m as E,aB as w,t as A,A as z}from"./index.c3bf3730.js";import{u as Y,Q as ee}from"./use-quasar.fc266504.js";import{Q as se}from"./QPage.472f2f16.js";import{Q as te,a as oe}from"./QLayout.c2166220.js";var ae=L({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:l,emit:p}){const q=D(),d=f(null);let c=0;const o=[];function P(s){const u=typeof s=="boolean"?s:e.noErrorFocus!==!0,y=++c,Q=(t,n)=>{p("validation"+(t===!0?"Success":"Error"),n)},k=t=>{const n=t.validate();return typeof n.then=="function"?n.then(r=>({valid:r,comp:t}),r=>({valid:!1,comp:t,err:r})):Promise.resolve({valid:n,comp:t})};return(e.greedy===!0?Promise.all(o.map(k)).then(t=>t.filter(n=>n.valid!==!0)):o.reduce((t,n)=>t.then(()=>k(n).then(r=>{if(r.valid===!1)return Promise.reject(r)})),Promise.resolve()).catch(t=>[t])).then(t=>{if(t===void 0||t.length===0)return y===c&&Q(!0),!0;if(y===c){const{comp:n,err:r}=t[0];if(r!==void 0&&console.error(r),Q(!1,n),u===!0){const _=t.find(({comp:x})=>typeof x.focus=="function"&&O(x.$)===!1);_!==void 0&&_.comp.focus()}}return!1})}function S(){c++,o.forEach(s=>{typeof s.resetValidation=="function"&&s.resetValidation()})}function C(s){s!==void 0&&B(s);const u=c+1;P().then(y=>{u===c&&y===!0&&(e.onSubmit!==void 0?p("submit",s):s!==void 0&&s.target!==void 0&&typeof s.target.submit=="function"&&s.target.submit())})}function R(s){s!==void 0&&B(s),p("reset"),K(()=>{S(),e.autofocus===!0&&e.noResetFocus!==!0&&g()})}function g(){M(()=>{if(d.value===null)return;const s=d.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||d.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||d.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(d.value.querySelectorAll("[tabindex]"),u=>u.tabIndex>-1);s!=null&&s.focus({preventScroll:!0})})}U(Z,{bindComponent(s){o.push(s)},unbindComponent(s){const u=o.indexOf(s);u>-1&&o.splice(u,1)}});let V=!1;return $(()=>{V=!0}),I(()=>{V===!0&&e.autofocus===!0&&g()}),N(()=>{e.autofocus===!0&&g()}),Object.assign(q.proxy,{validate:P,resetValidation:S,submit:C,reset:R,focus:g,getValidationComponents:()=>o}),()=>T("form",{class:"q-form",ref:d,onSubmit:C,onReset:R},j(l.default))}});const ne=H({setup(){return{q:Y(),username:f(""),password:f(""),passwordRepeat:f(""),isSignupRequest:f(!1),inProgress:f(!1)}},methods:{async login(){try{this.inProgress=!0,await F.login(this.username,this.password),this.q.notify({message:"Logged in!",color:"positive"}),setTimeout(()=>window.location.href="/",500)}catch(e){console.warn(e),this.q.notify({message:"Failed to login!",color:"negative",icon:"warning"})}finally{this.inProgress=!1}},async signup(){if(!this.isSignupRequest){this.isSignupRequest=!0;return}if(this.password!==this.passwordRepeat){this.q.notify({message:"Passwords do not match!",color:"negative",icon:"warning"});return}try{this.inProgress=!0,await F.signup(this.username,this.password,this.passwordRepeat),this.q.notify({message:"Signed Up!",color:"positive"}),setTimeout(()=>window.location.href="/",500)}catch(e){console.warn(e),this.q.notify({message:"Failed to sign up!",color:"negative",icon:"warning"})}finally{this.inProgress=!1}}}}),re=b("img",{src:"profile.svg",class:"q-pa-sm"},null,-1),ie={class:"text-center q-pt-lg"},le={key:0,class:"col text-h6 ellipsis"},ue={key:1,class:"col text-h6 ellipsis"};function de(e,l,p,q,d,c){return m(),v(te,null,{default:i(()=>[a(oe,null,{default:i(()=>[a(se,{class:"flex bg-image flex-center"},{default:i(()=>[a(J,{style:W(e.q.screen.lt.sm?{width:"80%"}:{width:"30%"})},{default:i(()=>[a(h,{class:"q-mb-md"},{default:i(()=>[a(X,{size:"150px",class:"absolute-center shadow-10",color:"primary"},{default:i(()=>[re]),_:1})]),_:1}),a(h,null,{default:i(()=>[b("div",ie,[e.isSignupRequest?(m(),E("div",le,"Sign Up")):(m(),E("div",ue,"Login"))])]),_:1}),a(h,null,{default:i(()=>[a(ae,{class:"q-gutter-md"},{default:i(()=>[a(w,{filled:"",modelValue:e.username,"onUpdate:modelValue":l[0]||(l[0]=o=>e.username=o),label:"Username","lazy-rules":""},null,8,["modelValue"]),a(w,{type:"password",filled:"",modelValue:e.password,"onUpdate:modelValue":l[1]||(l[1]=o=>e.password=o),label:"Password","lazy-rules":""},null,8,["modelValue"]),e.isSignupRequest?(m(),v(w,{key:0,type:"password",filled:"",modelValue:e.passwordRepeat,"onUpdate:modelValue":l[2]||(l[2]=o=>e.passwordRepeat=o),label:"Password Repeat","lazy-rules":""},null,8,["modelValue"])):A("",!0),e.inProgress?(m(),v(ee,{key:1,indeterminate:"",color:"secondary",class:"q-mt-sm"})):A("",!0),b("div",null,[a(z,{label:"Login",onClick:e.login,type:"button",color:"primary",disable:e.inProgress},null,8,["onClick","disable"]),a(z,{label:"Sign Up",onClick:e.signup,type:"button",color:"secondary",class:"float-right",disable:e.inProgress},null,8,["onClick","disable"])])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})}var ye=G(ne,[["render",de]]);export{ye as default};
